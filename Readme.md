# Reuse - 剪贴板增强工具（完整版）

## 一、简介

Reuse 是一款基于 Python 和 PyQt5 开发的剪贴板增强工具。它允许用户方便地保存、搜索和快速访问之前复制的内容。该工具会将剪贴板历史记录保存到本地 SQLite 数据库中，支持使用全局快捷键快速打开历史记录窗口，并提供悬浮窗预览功能，方便查看完整内容。

此外，本版本还支持：

- 分组管理剪贴板内容
- 编辑/删除/添加记录
- Strip 粘贴（去除首尾空格）
- 多种右键菜单交互
- 按组筛选记录

适合开发者、设计师、写作人员等需要频繁复制粘贴的用户。

---

## 二、功能特性

| 功能 | 描述 |
|------|------|
| ✅ 历史记录保存 | 自动将剪贴板内容保存至 SQLite 数据库，防止内容丢失 |
| ✅ 搜索功能 | 支持在历史记录中搜索关键词，快速定位所需内容 |
| ✅ 悬浮窗预览 | 鼠标悬停在记录上时显示完整内容 |
| ✅ 快捷键操作 | <ul><li>`Ctrl + Shift + Q`：全局快捷键打开历史窗口</li><li>`Esc`：关闭历史窗口</li><li>`Insert`：聚焦搜索框</li><li>`↑↓方向键`：切换选中行</li></ul> |
| ✅ 内容复制与粘贴 | 双击或回车键复制并粘贴内容，支持 strip 粘贴（去除前后空格） |
| ✅ 记录管理 | 支持添加、编辑、删除、清空记录 |
| ✅ 分组功能 | 支持创建、删除分组，按组筛选记录 |
| ✅ 设置功能 | 可设置历史记录最大保存数量 |

---

## 三、安装与运行

### 3.1 环境要求

- Python 3.x
- PyQt5
- sqlite3
- pynput
- win32api（仅适用于 Windows 系统）

### 3.2 安装依赖

```bash
pip install PyQt5 pynput pywin32
```

### 3.3 运行程序

将代码保存为 `reuse.py`，并将 `reuse.ico` 图标文件放在同一目录下，然后运行：

```bash
python reuse.py
```

---

## 四、使用方法

### 4.1 启动与打开

运行程序后，系统托盘图标将出现在任务栏右侧。按下快捷键 `Ctrl + Shift + Q` 或双击托盘图标即可打开历史记录窗口。

### 4.2 切换模式

点击界面顶部的“剪贴板”或“记录”按钮，可在两种模式间切换：

- **剪贴板模式**：查看系统剪贴板历史。
- **记录模式**：查看用户自定义记录，可按组分类。

### 4.3 搜索记录

在搜索框输入关键词，可以实时过滤当前显示的历史记录。

### 4.4 预览内容

鼠标悬停在任意记录上，会弹出一个浮动窗口展示完整内容。离开后自动隐藏。

### 4.5 复制与粘贴

- **双击记录** 或 **按下回车键**：将内容复制到剪贴板并自动粘贴。
- **Strip粘贴**：右键选择“strip粘贴”，将自动去除首尾空白后粘贴。

### 4.6 添加为记录

在剪贴板模式下右键某条记录，选择“添加为记录”，可以选择将其保存到指定组中。

### 4.7 编辑记录

在记录模式下右键某条记录，选择“编辑”，可以修改其内容和所属组。

### 4.8 删除记录

在剪贴板或记录模式下右键某条记录，选择“删除”即可移除。

### 4.9 清空历史记录

点击“设置” > “退出”上方的“清空所有非置顶记录”。

### 4.10 分组管理

点击“设置” > “组管理”：
- **新建组**：创建一个新的分组
- **删除组**：删除已有组及其所有记录

### 4.11 设置历史记录数量

点击“设置” > “设置最大记录数”，输入数字（20 - 500），限制最多保存的记录数。

---

## 五、注意事项

1. 确保 [reuse.ico](reuse.ico) 文件存在于代码文件的同一目录下，否则将使用默认系统托盘图标。
2. 当前仅支持 Windows 系统，部分功能依赖于 Windows API。
3. 如果未找到可用组，添加记录时会提示是否添加到默认组。
4. 使用 `pynput` 实现全局快捷键监听，确保后台常驻。

---

## 六、代码结构说明

### 6.1 [WorkerSignals](reuse.py#L17-L18) 类

用于定义跨线程通信信号，如主窗口显示信号 [show_window](reuse.py#L18-L18)。

### 6.2 [PreviewDialog](reuse.py#L20-L80) 类

实现悬浮窗预览功能，宽度与主窗口一致，高度根据内容自适应调整。

### 6.3 [ReuseDatabase](reuse.py#L82-L219) 类

负责数据库操作，包含以下主要方法：

- [create_table()](reuse.py#L90-L105)：创建剪贴板和记录表
- [save_clip(content)](reuse.py#L107-L124)：保存新的剪贴板内容
- [get_all_clips(limit)](reuse.py#L126-L137)：获取所有剪贴板记录
- [search_clips(keyword, limit)](reuse.py#L602-L617)：搜索剪贴板记录
- [delete_clip(clip_id)](reuse.py#L152-L155)：删除单条记录
- [clear_all()](reuse.py#L157-L160)：清空所有记录
- [set_limit(limit)](reuse.py#L162-L169)：设置最大保存记录数
- [update_clip_as_latest(clip_id)](reuse.py#L171-L182)：将某条记录更新为最新记录
- [add_record(content, group)](reuse.py#L183-L186)：添加一条带组名的记录
- [get_records(group, keyword)](reuse.py#L188-L195)：按组和关键字查询记录
- [delete_record(record_id)](reuse.py#L919-L924)：删除记录
- `update_record(record_id, content, group)`：编辑记录
- [add_group(name)](reuse.py#L206-L213)：新建组
- [delete_group(name)](reuse.py#L215-L219)：删除组及其所有记录

### 6.4 [ReuseHistoryWindow](reuse.py#L221-L959) 类

剪贴板历史记录的主窗口，核心功能包括：

- 支持剪贴板/记录两种模式切换
- 悬浮窗预览
- 表格操作（搜索、刷新、复制、删除等）
- 组筛选下拉框
- 快捷键绑定
- 右键菜单操作

### 6.5 [ReuseManager](reuse.py#L961-L1125) 类

管理剪贴板监控、快捷键注册、系统托盘图标及主窗口显示逻辑。

---

## 七、贡献与反馈

如果你发现任何 bug 或有改进建议，欢迎提交 issue 或 pull request。你也可以通过以下方式联系作者：

- GitHub: [https://github.com/yourname/reuse](https://github.com/yourname/reuse)
- 邮箱: yourname@example.com

---

## 八、许可证

本项目采用 [MIT 许可证](https://opensource.org/licenses/MIT)。

---

## 九、常见问题

### 如何添加记录？

在剪贴板模式下，右键某条记录 → 选择“添加为记录” → 选择组名即可。

### 如何编辑记录？

在记录模式下，右键某条记录 → 选择“编辑” → 修改内容和组名。

### 如何创建新组？

点击“设置” > “组管理” > “新建组” → 输入组名。

### 如何删除组？

点击“设置” > “组管理” > “删除组” → 选择要删除的组名。

### 如何清空记录？

点击“设置” > “清空所有记录”。

